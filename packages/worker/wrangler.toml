name = "dartmouth-os-worker"
main = "src/index.ts"
compatibility_date = "2025-11-16"
compatibility_flags = ["nodejs_compat"]

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "dartmouth-os-db"
database_id = "394bcee5-559f-4e9f-b212-c8095adf34fa"

# KV Namespaces
[[kv_namespaces]]
binding = "APP_CONFIG"
id = "ad1e9fefaa934cf0a3917abda62ee9c6"
preview_id = "234a0da16fa64036b336468050220e03"

[[kv_namespaces]]
binding = "CACHE"
id = "694d0ca8467c451d9a85b2b3bef3a519"
preview_id = "ad762076df8943ca95eaea30ae453681"

# R2 Buckets for file attachments (OPTIONAL - comment out if you don't want to use R2)
# The system will automatically fallback to storing files as base64 in the database
# [[r2_buckets]]
# binding = "ATTACHMENTS"
# bucket_name = "dartmouth-attachments"
# preview_bucket_name = "dartmouth-os-files-preview"

# Workers AI
[ai]
binding = "WORKERS_AI"

# Vectorize (RAG Vector Database) - Commented out until index is created
# To enable: Create index via Cloudflare dashboard or: npx wrangler vectorize create dartmouth-rag --dimensions=1536 --metric=cosine
# Then uncomment the lines below:
# [[vectorize]]
# binding = "VECTORIZE"
# index_name = "dartmouth-rag"

# Observability
[observability]
enabled = true

# Development server settings
[dev]
port = 8788
ip = "127.0.0.1"

# Environment Variables (non-secret)
[vars]
ENVIRONMENT = "production"
LLM_PROVIDER = "openai"
LLM_MODEL = "gpt-4o-mini"
GMAIL_REDIRECT_URI = "https://dartmouth-os-worker.your-subdomain.workers.dev/oauth/callback"
AI_RESPONSE_MODE = "draft"  # "auto" or "draft"

# Scheduled Workers (Cron Jobs)
[triggers]
crons = ["*/5 * * * *"]  # Run email poller every 5 minutes

# Secrets (set via wrangler secret put)
# - STRIPE_SECRET_KEY
# - STRIPE_WEBHOOK_SECRET
# - CLERK_SECRET_KEY
# - JWT_SECRET
# - OPENAI_API_KEY
# - ANTHROPIC_API_KEY
# - GOOGLE_API_KEY
# - GMAIL_CLIENT_ID
# - GMAIL_CLIENT_SECRET
# - GMAIL_REFRESH_TOKEN
# - SHOPIFY_API_URL
# - SHOPIFY_ACCESS_TOKEN
# - PERP_API_URL
# - PERP_API_KEY

